<!doctype html>
<html>
<head>
 <title>irmf-editor</title>
 <meta charset="utf-8">
</head>

<body style="background:#000">
<div id="container" style="width:800px;height:600px;border:1px solid grey"></div>
<!-- <div id="canvas" style="width:50%;height:100%;border:1px solid grey;position:absolute;top:0,float:right"></div> -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.17.1/min/vs/loader.js"></script>
<script>
  require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.17.1/min/vs' }});

  // Before loading vs/editor/editor.main, define a global MonacoEnvironment that overwrites
  // the default worker url location (used when creating WebWorkers). The problem here is that
  // HTML5 does not allow cross-domain web workers, so we need to proxy the instantiation of
  // a web worker through a same-domain script
  window.MonacoEnvironment = {
    getWorkerUrl: function(workerId, label) {
      return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
        self.MonacoEnvironment = {
          baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.17.1/min/'
        };
        importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.17.1/min/vs/base/worker/workerMain.js');`
      )}`;
    }
  };

  var editor = null;
  require(["vs/editor/editor.main"], function () {
    console.log('editor started');
    monaco.editor.defineTheme('myCustomTheme', {
	base: 'vs-dark', // can also be vs or hc-black
	inherit: true, // can also be false to completely replace the builtin rules
	rules: [
		{ token: 'comment', foreground: 'ffa500', fontStyle: 'italic underline' },
		{ token: 'comment.js', foreground: '008800', fontStyle: 'bold' },
		{ token: 'comment.css', foreground: '0000ff' } // will inherit fontStyle from `comment` above
	]
    });
    editor = monaco.editor.create(document.getElementById('container'), {
      value: [
          '/*{',
          '  irmf: "1.0",',
          '  materials: ["PLA"],',
          '  max: [10,10,10],',
          '  min: [0,0,0],',
          '  units: "mm",',
          '}*/',
          '',
          'void mainModel4( out vec4 materials, in vec3 xyz ) {',
          '  materials[0] = 1.0;',
          '}'
      ].join('\n'),
      language: 'javascript',
      scrollBeyondLastLine: false,
      theme: "myCustomTheme"
    });
  });
</script>
<script src="wasm_exec.js"></script>
<script>
if (!WebAssembly.instantiateStreaming) { // polyfill
 WebAssembly.instantiateStreaming = async (resp, importObject) => {
 const source = await (await resp).arrayBuffer();
  return await WebAssembly.instantiate(source, importObject);
 };
}
const go = new Go();
WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then((result) => {
 go.run(result.instance);
});
</script>
</body>
</html>
